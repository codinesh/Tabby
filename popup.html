<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Tabby</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="popup.css" />
    <!-- Load the transformers library as a module -->
    <script type="module" src="lib/transformers.min.js"></script>
  </head>
  <body>
    <div class="header">
      <h1>Tabby</h1>
      <div class="header-actions">
        <div id="status-container" class="hidden">
          <div id="status-message"></div>
          <div id="loading-spinner"></div>
        </div>
        <button
          class="menu-button theme-toggle"
          id="theme-toggle"
          title="Toggle dark mode"
        >
          üåô
        </button>
        <div class="menu-container">
          <button
            id="menu-button"
            class="menu-button"
            aria-label="Menu"
            aria-haspopup="menu"
            aria-expanded="false"
            aria-controls="context-menu"
          >
            <i aria-hidden="true">‚öôÔ∏è</i>
          </button>
          <div
            id="context-menu"
            class="context-menu hidden"
            role="menu"
            aria-labelledby="menu-button"
          >
            <ul role="none">
              <li role="none">
                <button id="menu-refresh-tabs" role="menuitem" tabindex="-1">
                  <i aria-hidden="true">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 512 512"
                    >
                      <path
                        d="M142.9 142.9c-17.5 17.5-30.1 38-37.8 59.8c-5.9 16.7-24.2 25.4-40.8 19.5s-25.4-24.2-19.5-40.8C55.6 150.7 73.2 122 97.6 97.6c87.2-87.2 228.3-87.5 315.8-1L455 55c6.9-6.9 17.2-8.9 26.2-5.2s14.8 12.5 14.8 22.2l0 128c0 13.3-10.7 24-24 24l-8.4 0c0 0 0 0 0 0L344 224c-9.7 0-18.5-5.8-22.2-14.8s-1.7-19.3 5.2-26.2l41.1-41.1c-62.6-61.5-163.1-61.2-225.3 1zM16 312c0-13.3 10.7-24 24-24l7.6 0 .7 0L168 288c9.7 0 18.5 5.8 22.2 14.8s1.7 19.3-5.2 26.2l-41.1 41.1c62.6 61.5 163.1 61.2 225.3-1c17.5-17.5 30.1-38 37.8-59.8c5.9-16.7 24.2-25.4 40.8-19.5s25.4 24.2 19.5 40.8c-10.8 30.6-28.4 59.3-52.9 83.8c-87.2 87.2-228.3 87.5-315.8 1L57 457c-6.9 6.9-17.2 8.9-26.2 5.2S16 449.7 16 440l0-119.6 0-.7 0-7.6z"
                      />
                    </svg>
                  </i>
                  <span>Refresh Tabs</span>
                </button>
              </li>
              <li role="none">
                <button id="menu-settings" role="menuitem" tabindex="-1">
                  <i aria-hidden="true">‚öôÔ∏è</i>
                  <span>Settings</span>
                </button>
              </li>
              <li role="none">
                <button id="backup-tabs" role="menuitem" tabindex="-1">
                  <i aria-hidden="true">üíæ</i>
                  <span>Backup Tabs</span>
                </button>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <div id="main-content">
      <div class="content-scroll">
        <!-- Search bar -->
        <div class="search-container">
          <input
            type="text"
            id="search-input"
            class="search-input"
            placeholder="Search tabs..."
          />
          <span class="search-icon">üîç</span>
        </div>

        <div class="controls">
          <div class="group-controls">
            <button id="group-by-ai" class="primary-button">Group by AI</button>
            <button id="group-by-domain" class="secondary-button">
              Domain
            </button>
            <button
              id="ungroup-tabs"
              class="secondary-button"
              title="Ungroup All Tabs"
            >
              <i aria-hidden="true">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">
                  <path
                    d="M264.5 5.2c14.9-6.9 32.1-6.9 47 0l218.6 101c8.5 3.9 13.9 12.4 13.9 21.8s-5.4 17.9-13.9 21.8l-218.6 101c-14.9 6.9-32.1 6.9-47 0L45.9 149.8C37.4 145.8 32 137.3 32 128s5.4-17.9 13.9-21.8L264.5 5.2zM476.9 209.6l53.2 24.6c8.5 3.9 13.9 12.4 13.9 21.8s-5.4 17.9-13.9 21.8l-218.6 101c-14.9 6.9-32.1 6.9-47 0L45.9 277.8C37.4 273.8 32 265.3 32 256s5.4-17.9 13.9-21.8l53.2-24.6 152 70.2c23.4 10.8 50.4 10.8 73.8 0l152-70.2zm-152 198.2l152-70.2 53.2 24.6c8.5 3.9 13.9 12.4 13.9 21.8s-5.4 17.9-13.9 21.8l-218.6 101c-14.9 6.9-32.1 6.9-47 0L45.9 405.8C37.4 401.8 32 393.3 32 384s5.4-17.9 13.9-21.8l53.2-24.6 152 70.2c23.4 10.8 50.4 10.8 73.8 0z"
                  />
                </svg>
              </i>
            </button>
            <button
              id="collapse-tabs"
              class="secondary-button"
              title="Collapse All Groups"
            >
              <i aria-hidden="true">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                  <path
                    d="M233.4 406.6c12.5 12.5 32.8 12.5 45.3 0l192-192c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L256 338.7 86.6 169.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l192 192z"
                  />
                </svg>
              </i>
            </button>
            <button
              id="expand-tabs"
              class="secondary-button"
              title="Expand All Groups"
            >
              <i aria-hidden="true">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                  <path
                    d="M233.4 105.4c12.5-12.5 32.8-12.5 45.3 0l192 192c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L256 173.3 86.6 342.6c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3l192-192z"
                  />
                </svg>
              </i>
            </button>
          </div>
        </div>

        <!-- Recent Groups Section -->
        <div class="recent-groups hidden">
          <div class="recent-groups-title">Recent Groups</div>
          <div id="recent-groups-list"></div>
        </div>

        <div id="tabs-list">
          <!-- Tabs will be listed here -->
        </div>
      </div>
    </div>

    <div id="settings-content" class="hidden">
      <div class="content-scroll">
        <div class="settings-header">
          <h2>Settings</h2>
        </div>

        <div class="settings-body">
          <div class="settings-tabs">
            <button class="settings-tab active" data-tab="groups-settings">
              Custom Groups
            </button>
            <button class="settings-tab" data-tab="api-settings">API</button>
            <button class="settings-tab" data-tab="appearance-settings">
              Appearance
            </button>
          </div>

          <div id="groups-settings" class="settings-content">
            <div class="form-group">
              <p class="help-text">
                Configure your preferred groups and the keywords that should be
                included in each group.
              </p>
              <div id="custom-groups-container">
                <!-- Custom groups will be added here dynamically -->
              </div>
              <div class="group-actions">
                <button id="add-group" class="small-button">+ Add Group</button>
              </div>
            </div>
          </div>

          <div id="api-settings" class="settings-content hidden">
            <div class="form-group">
              <label for="ai-url">API Endpoint:</label>
              <input
                type="text"
                id="ai-url"
                placeholder="https://api.openai.com/v1/chat/completions"
                value="https://api.openai.com/v1/chat/completions"
              />
            </div>
            <div class="form-group">
              <label for="api-key">API Key:</label>
              <input type="password" id="api-key" placeholder="Your API key" />
            </div>
          </div>

          <div id="appearance-settings" class="settings-content hidden">
            <div class="form-group">
              <label>Theme</label>
              <div class="theme-options">
                <button id="theme-light" class="theme-option">Light</button>
                <button id="theme-dark" class="theme-option">Dark</button>
                <button id="theme-system" class="theme-option">System</button>
              </div>
            </div>
            <div class="form-group">
              <label>Default Group Colors</label>
              <div class="color-picker">
                <div class="color-option grey" data-color="grey"></div>
                <div class="color-option blue" data-color="blue"></div>
                <div class="color-option red" data-color="red"></div>
                <div class="color-option yellow" data-color="yellow"></div>
                <div class="color-option green" data-color="green"></div>
                <div class="color-option pink" data-color="pink"></div>
                <div class="color-option purple" data-color="purple"></div>
                <div class="color-option cyan" data-color="cyan"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="settings-actions">
          <button id="save-settings" class="primary-button">Save</button>
          <button id="cancel-settings" class="secondary-button">Cancel</button>
        </div>
      </div>
    </div>

    <template id="custom-group-template">
      <div class="custom-group">
        <div class="form-row">
          <input
            type="text"
            class="group-name"
            placeholder="Group name (e.g., Workflow)"
          />
          <select class="group-color">
            <option value="grey">Grey</option>
            <option value="blue">Blue</option>
            <option value="red">Red</option>
            <option value="yellow">Yellow</option>
            <option value="green">Green</option>
            <option value="pink">Pink</option>
            <option value="purple">Purple</option>
            <option value="cyan">Cyan</option>
          </select>
          <button class="remove-group small-button">‚úï</button>
        </div>
        <div class="form-row keywords-container">
          <input
            type="text"
            class="group-keywords"
            placeholder="Keywords (comma separated, e.g., workflow, process, task)"
          />
        </div>
      </div>
    </template>

    <script type="module" src="popup.js"></script>
  </body>
</html>
